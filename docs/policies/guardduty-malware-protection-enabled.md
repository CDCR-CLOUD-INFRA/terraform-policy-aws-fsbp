# GuardDuty Malware Protection for EC2 should be enabled

| Provider            | Category           |
|---------------------|--------------------|
| Amazon Web Services | Detection services |

## Description

DISCLAIMER - This policy works when all resources of type aws_guardduty_detector and aws_guardduty_detector_feature are present in the root module.

This control checks whether GuardDuty Malware Protection is enabled. For a standalone account, the control fails if GuardDuty Malware Protection is disabled in the account. In a multi-account environment, the control fails if the delegated GuardDuty administrator account and all member accounts don't have Malware Protection enabled.

In a multi-account environment, the control generates findings in only the delegated GuardDuty administrator account. Only the delegated administrator can enable or disable the Malware Protection feature for the member accounts in the organization. GuardDuty member accounts can't modify this configuration from their accounts. This control generates FAILED findings if the delegated GuardDuty administrator has a suspended member account that doesn't have GuardDuty Malware Protection enabled. To receive a PASSED finding, the delegated administrator must disassociate these suspended accounts in GuardDuty.

GuardDuty Malware Protection for EC2 helps you detect the potential presence of malware by scanning the Amazon Elastic Block Store (Amazon EBS) volumes that are attached to Amazon Elastic Compute Cloud (Amazon EC2) instances and container workloads. Malware Protection provides scan options where you can decide if you want to include or exclude specific EC2 instances and container workloads at the time of scanning. It also provides an option to retain the snapshots of EBS volumes attached to the EC2 instances or container workloads, in your GuardDuty accounts. The snapshots get retained only when malware is found and Malware Protection findings are generated.

This rule is covered by the [guardduty-malware-protection-enabled](https://github.com/hashicorp/policy-library-FSBP-Policy-Set-for-AWS-Terraform/blob/main/policies/guardduty/guardduty-malware-protection-enabled.sentinel) policy.

## Policy Results (Pass)
```bash
trace:
      Pass - guardduty-malware-protection-enabled.sentinel

      Description:
        This control checks whether 'aws_guardduty_detector' and
        'aws_guardduty_detector_feature' have Malware Protection enabled.

      Print messages:

      → → Overall Result: true

      This result means that all resources have passed the policy check for the policy guardduty-malware-protection-enabled.

      ✓ Found 0 resource violations

      guardduty-malware-protection-enabled.sentinel:77:1 - Rule "main"
        Value:
          true
```

---

## Policy Results (Fail)
```bash
trace:
      Fail - guardduty-malware-protection-enabled.sentinel

      Description:
        This control checks whether 'aws_guardduty_detector' and
        'aws_guardduty_detector_feature' have Malware Protection enabled.

      Print messages:

      → → Overall Result: false

      This result means that not all resources passed the policy check and the protected behavior is not allowed for the policy guardduty-malware-protection-enabled.

      Found 1 resource violations

      → Module name: root
        ↳ Resource Address: aws_guardduty_detector.example
          | ✗ failed
          | 'aws_guardduty_detector' and 'aws_guardduty_detector_feature' should have Malware Protection enabled. Refer to https://docs.aws.amazon.com/securityhub/latest/userguide/guardduty-controls.html#guardduty-8 for more details.


      guardduty-malware-protection-enabled.sentinel:78:1 - Rule "main"
        Value:
          false
```

---